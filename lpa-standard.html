<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standard LPA Generator | Lasting Power of Attorney</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìã</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="auth.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <span class="logo-icon">üìã</span>
                <div>
                    <h1>Standard LPA Generator</h1>
                    <p>Lasting Power of Attorney</p>
                </div>
            </div>
            <nav class="header-nav">
                <a href="home.html" class="nav-link">Home</a>
                <a href="index.html" class="nav-link" id="nav-islamic-will">Islamic Will</a>
                <a href="lpa.html" class="nav-link" id="nav-islamic-lpa">Islamic LPA</a>
                <a href="will-standard.html" class="nav-link" id="nav-standard-will">Standard Will</a>
                <a href="lpa-standard.html" class="nav-link nav-link-active" id="nav-standard-lpa">Standard LPA</a>
            </nav>
        </div>
    </header>

    <!-- Action Toolbar -->
    <div class="toolbar">
        <div class="container">
            <div class="toolbar-left">
                <span class="toolbar-title" id="currentClientName">New LPA</span>
                <span class="toolbar-status" id="currentStatus">Draft</span>
            </div>
            <div class="toolbar-right">
                <button class="toolbar-btn" onclick="resetForm()" title="Start New">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line></svg>
                    <span>New</span>
                </button>
                <button class="toolbar-btn" onclick="loadSavedLpas()" title="Open Saved LPAs">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>
                    <span>Open</span>
                </button>
                <button class="toolbar-btn" onclick="saveProgress()" title="Save Progress">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                    <span>Save</span>
                </button>
                <button class="toolbar-btn toolbar-btn-primary" onclick="saveAndStartNew()" title="Save & Start New Client">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                    <span>Save & Next Client</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-steps" id="progressSteps"></div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main">
        <div class="container">

            <!-- ==================== STEP 1: Welcome & LPA Type ==================== -->
            <section class="step active" data-step="1">
                <div class="step-header">
                    <span class="step-icon">üìã</span>
                    <h2>Lasting Power of Attorney</h2>
                    <p>Create a legally compliant LPA for England & Wales</p>
                </div>

                <div class="info-box">
                    <h3>Why Do You Need an LPA?</h3>
                    <p>A Lasting Power of Attorney (LPA) allows you to appoint trusted people to make decisions on your behalf if you lose mental capacity. Without an LPA, decisions about your finances, health, and welfare could be made by someone appointed by the Court of Protection, who may not know your wishes.</p>
                    <p style="margin-top: 0.75rem;">An LPA gives you control over who will manage your affairs and ensures your preferences are respected even if you are unable to communicate them yourself.</p>
                </div>

                <div class="form-section">
                    <h3>Select LPA Type</h3>
                    <p class="form-description">There are two types of LPA in England and Wales. You need a separate LPA for each.</p>

                    <div class="radio-cards">
                        <label class="radio-card">
                            <input type="radio" name="lpaType" value="property" checked>
                            <div class="radio-card-content">
                                <div class="radio-card-icon">üí∞</div>
                                <h4>Property & Financial Affairs (LP1F)</h4>
                                <p>Covers decisions about your bank accounts, investments, property, bills, and tax payments.</p>
                            </div>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="lpaType" value="health">
                            <div class="radio-card-content">
                                <div class="radio-card-icon">üè•</div>
                                <h4>Health & Welfare (LP1H)</h4>
                                <p>Covers decisions about medical treatment, care arrangements, dietary needs, and end-of-life wishes.</p>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <button type="button" class="btn btn-outline-accent" onclick="showGovFormPreview()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        Preview Official Government Form Structure
                    </button>
                    <p class="form-description" style="margin-top: 0.5rem;">See what sections the official LPA form contains and how your data will be used.</p>
                </div>
            </section>

            <!-- ==================== STEP 2: The Donor ==================== -->
            <section class="step" data-step="2">
                <div class="step-header">
                    <span class="step-icon">üë§</span>
                    <h2>The Donor (Your Details)</h2>
                    <p>Section 1 of the official LPA form - your personal information</p>
                </div>

                <div class="info-box">
                    <p>The <strong>Donor</strong> is you - the person creating the LPA. Enter your details exactly as they appear on your official documents.</p>
                </div>

                <div class="form-section">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required" for="donorTitle">Title</label>
                            <select class="form-input" id="donorTitle" required>
                                <option value="">Select...</option>
                                <option value="Mr">Mr</option>
                                <option value="Mrs">Mrs</option>
                                <option value="Miss">Miss</option>
                                <option value="Ms">Ms</option>
                                <option value="Dr">Dr</option>
                                <option value="Prof">Prof</option>
                                <option value="Rev">Rev</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="donorFirstNames">First Names</label>
                            <input type="text" class="form-input" id="donorFirstNames" required placeholder="e.g., John Michael">
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="donorLastName">Last Name</label>
                            <input type="text" class="form-input" id="donorLastName" required placeholder="e.g., Smith">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="donorAka">Also Known As (if applicable)</label>
                            <input type="text" class="form-input" id="donorAka" placeholder="Other names you're known by">
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="donorDob">Date of Birth</label>
                            <input type="date" class="form-input" id="donorDob" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="donorNi">National Insurance Number</label>
                            <input type="text" class="form-input" id="donorNi" placeholder="e.g., QQ 12 34 56 C">
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label required" for="donorAddress">Address (including postcode)</label>
                            <textarea class="form-input" id="donorAddress" required rows="3" placeholder="Full address including postcode"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="donorEmail">Email Address</label>
                            <input type="email" class="form-input" id="donorEmail" placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="donorPhone">Phone Number</label>
                            <input type="tel" class="form-input" id="donorPhone" placeholder="e.g., 07700 900123">
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== STEP 3: The Attorneys ==================== -->
            <section class="step" data-step="3">
                <div class="step-header">
                    <span class="step-icon">üë•</span>
                    <h2>The Attorneys</h2>
                    <p>Section 2 of the official LPA form - who will make decisions for you</p>
                </div>

                <div class="info-box">
                    <h4>Choosing Your Attorneys</h4>
                    <p>Choose people you trust to make important decisions on your behalf. They should be reliable, competent, and willing to act in your best interests. You can appoint family members, friends, or professionals such as solicitors.</p>
                </div>

                <div class="form-section">
                    <h3>Your Attorneys</h3>
                    <p class="form-description">Add at least one attorney. You may appoint multiple attorneys.</p>
                    <div id="attorneysList"></div>
                    <button type="button" class="btn btn-add" onclick="addAttorney()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"></circle><path d="M20 21a8 8 0 1 0-16 0"></path><line x1="20" y1="8" x2="20" y2="14"></line><line x1="17" y1="11" x2="23" y2="11"></line></svg>
                        Add Attorney
                    </button>
                </div>

                <div class="form-section">
                    <h3>How Should Your Attorneys Act?</h3>

                    <div class="radio-cards">
                        <label class="radio-card">
                            <input type="radio" name="attorneyDecision" value="jointly" checked>
                            <div class="radio-card-content">
                                <h4>Jointly</h4>
                                <p>All attorneys must agree on every decision. If one can no longer act, none of them can act (unless you have replacement attorneys).</p>
                            </div>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="attorneyDecision" value="jointly-severally">
                            <div class="radio-card-content">
                                <h4>Jointly and Severally</h4>
                                <p>Attorneys can make decisions together or independently. If one can no longer act, the others can continue.</p>
                            </div>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="attorneyDecision" value="mixed">
                            <div class="radio-card-content">
                                <h4>Mixed</h4>
                                <p>Jointly for some decisions, jointly and severally for others. You must specify which decisions require joint agreement.</p>
                            </div>
                        </label>
                    </div>

                    <div id="mixedDecisionDetails" style="display: none; margin-top: 1rem;">
                        <div class="form-group full-width">
                            <label class="form-label required" for="jointDecisions">Specify which decisions must be made jointly:</label>
                            <textarea class="form-input" id="jointDecisions" rows="3" placeholder="e.g., Selling property, investments over ¬£10,000, major financial commitments..."></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== STEP 4: Attorney Decisions / Authority ==================== -->
            <section class="step" data-step="4">
                <div class="step-header">
                    <span class="step-icon">‚öñÔ∏è</span>
                    <h2>Attorney Authority</h2>
                    <p>Section 3 of the official LPA form</p>
                </div>

                <!-- Property & Financial: When can attorneys act? -->
                <div id="propertyDecisionSection">
                    <div class="info-box">
                        <h4>When Can Your Attorneys Act? (Property & Financial)</h4>
                        <p>Choose when your attorneys can start making financial decisions on your behalf.</p>
                    </div>

                    <div class="form-section">
                        <div class="radio-cards">
                            <label class="radio-card">
                                <input type="radio" name="attorneysCanAct" value="registered" checked>
                                <div class="radio-card-content">
                                    <h4>As Soon as the LPA is Registered</h4>
                                    <p>Your attorneys can act immediately after registration, even while you have full mental capacity. This can be useful for day-to-day financial management.</p>
                                </div>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="attorneysCanAct" value="lack-capacity">
                                <div class="radio-card-content">
                                    <h4>Only When I Lack Mental Capacity</h4>
                                    <p>Your attorneys can only act if and when you are unable to make your own decisions. A medical assessment may be needed.</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Health & Welfare: Life-sustaining treatment -->
                <div id="healthDecisionSection" style="display: none;">
                    <div class="info-box">
                        <h4>Life-Sustaining Treatment (Health & Welfare)</h4>
                        <p>You need to decide whether your attorneys should have the authority to give or refuse consent to life-sustaining treatment on your behalf. This is an important decision - consider discussing it with your family and medical professionals.</p>
                    </div>

                    <div class="form-section">
                        <div class="radio-cards">
                            <label class="radio-card">
                                <input type="radio" name="lifeSustainingAuthority" value="give" checked>
                                <div class="radio-card-content">
                                    <h4>I Give My Attorneys Authority</h4>
                                    <p>Your attorneys can consent to or refuse life-sustaining treatment on your behalf.</p>
                                </div>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="lifeSustainingAuthority" value="do-not-give">
                                <div class="radio-card-content">
                                    <h4>I Do NOT Give Authority</h4>
                                    <p>Your attorneys cannot make decisions about life-sustaining treatment. These decisions will be made by healthcare professionals.</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== STEP 5: Replacement Attorneys ==================== -->
            <section class="step" data-step="5">
                <div class="step-header">
                    <span class="step-icon">üîÑ</span>
                    <h2>Replacement Attorneys</h2>
                    <p>Section 4 of the official LPA form - backup attorneys if your chosen ones can no longer act</p>
                </div>

                <div class="info-box">
                    <h4>Why Appoint Replacement Attorneys?</h4>
                    <p>Replacement attorneys step in if one of your original attorneys can no longer act (due to death, incapacity, or choice). It is recommended to appoint at least one replacement to ensure continuity.</p>
                </div>

                <div class="form-section">
                    <h3>Replacement Attorneys <span style="font-weight: normal; color: #6b7280;">(Optional but recommended)</span></h3>
                    <div id="replacementAttorneysList"></div>
                    <button type="button" class="btn btn-add" onclick="addReplacementAttorney()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"></circle><path d="M20 21a8 8 0 1 0-16 0"></path><line x1="20" y1="8" x2="20" y2="14"></line><line x1="17" y1="11" x2="23" y2="11"></line></svg>
                        Add Replacement Attorney
                    </button>
                </div>
            </section>

            <!-- ==================== STEP 6: People to Notify ==================== -->
            <section class="step" data-step="6">
                <div class="step-header">
                    <span class="step-icon">üì¨</span>
                    <h2>People to Notify</h2>
                    <p>Section 5 of the official LPA form - people who should know when your LPA is being registered</p>
                </div>

                <div class="info-box">
                    <h4>Who Should Be Notified?</h4>
                    <p>These people will be notified when your LPA is being registered with the Office of the Public Guardian. They can raise concerns if they believe the LPA should not be registered. You can name up to 5 people.</p>
                    <p style="margin-top: 0.5rem;">Consider notifying: a family member, a trusted friend, your solicitor, or a community leader.</p>
                </div>

                <div class="form-section">
                    <h3>People to Notify <span style="font-weight: normal; color: #6b7280;">(Optional)</span></h3>
                    <div id="notifyPersonsList"></div>
                    <button type="button" class="btn btn-add" onclick="addNotifyPerson()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        Add Person to Notify
                    </button>
                </div>
            </section>

            <!-- ==================== STEP 7: Preferences & Instructions ==================== -->
            <section class="step" data-step="7">
                <div class="step-header">
                    <span class="step-icon">üìù</span>
                    <h2>Preferences & Instructions</h2>
                    <p>Specify any preferences or instructions for your attorneys</p>
                </div>

                <div class="info-box">
                    <h4>Instructions vs Preferences</h4>
                    <p><strong>Instructions</strong> are BINDING - your attorneys MUST follow them. <strong>Preferences</strong> are guidance - your attorneys should consider them but have flexibility.</p>
                    <p style="margin-top: 0.5rem;">The options you select below will be written into Section 7 of the official government form.</p>
                </div>

                <!-- Property & Financial Instructions -->
                <div id="propertyInstructions">
                    <div class="form-section">
                        <h3>Financial Management Preferences</h3>
                        <p class="form-description">Select the preferences you would like your attorneys to follow when managing your financial affairs.</p>

                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefEthicalInvestments">
                                <span><strong>Ethical Investments:</strong> Maintain ethical investments where possible, avoiding companies with poor environmental, social, or governance records.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefPayDebts">
                                <span><strong>Prioritise Debt Repayment:</strong> Prioritise paying off debts before making other financial commitments.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefPropertyMaintained">
                                <span><strong>Property Management:</strong> Keep property managed and maintained to a reasonable standard.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefCharitableDonations">
                                <span><strong>Charitable Donations:</strong> Continue regular charitable donations from income where financially viable.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefFinancialAdvisor">
                                <span><strong>Consult Financial Advisor:</strong> Consult a financial advisor for major decisions involving investments, property sales, or large expenditures.</span>
                            </label>
                        </div>

                        <div class="form-grid" style="margin-top: 1rem;">
                            <div class="form-group">
                                <label class="form-label" for="preferredAdvisorBank">Preferred Financial Advisor / Bank</label>
                                <input type="text" class="form-input" id="preferredAdvisorBank" placeholder="e.g., Smith & Co Financial Advisors, Barclays">
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="consultThreshold">Threshold for Consultation</label>
                                <input type="text" class="form-input" id="consultThreshold" placeholder="e.g., Consult me for decisions over ¬£5,000">
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label" for="additionalFinancialInstructions">Additional Financial Instructions</label>
                                <textarea class="form-input" id="additionalFinancialInstructions" rows="3" placeholder="Any specific binding instructions your attorneys MUST follow regarding your financial affairs..."></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label" for="additionalFinancialPreferences">Additional Financial Preferences</label>
                                <textarea class="form-input" id="additionalFinancialPreferences" rows="3" placeholder="Any other non-binding guidance for your attorneys regarding financial management..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health & Welfare Instructions -->
                <div id="healthInstructions" style="display: none;">
                    <div class="form-section">
                        <h3>Care & Welfare Preferences</h3>
                        <p class="form-description">Select the preferences you would like your attorneys to follow regarding your health and welfare.</p>

                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefHomeCare" checked>
                                <span><strong>Home Care:</strong> Prefer to be cared for at home where possible, for as long as practically and financially feasible.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefCareFacility">
                                <span><strong>Preferred Care Facility:</strong> Prefer a particular care facility or type of residential home if home care is no longer viable.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefDietaryRequirements">
                                <span><strong>Dietary Requirements:</strong> Prefer specific dietary requirements be maintained (e.g., vegetarian, vegan, allergies, cultural preferences).</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefRegularVisitors">
                                <span><strong>Regular Visitors:</strong> Wish to have regular visitors from family, friends, and community members.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefCulturalPractices">
                                <span><strong>Cultural/Spiritual Practices:</strong> Wish to continue cultural or spiritual practices that are important to me.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefMentalHealthTreatment">
                                <span><strong>Mental Health Treatment:</strong> If psychiatric treatment is required, ensure therapy and counselling are respectful of my personal values and beliefs.</span>
                            </label>
                        </div>

                        <div class="form-grid" style="margin-top: 1rem;">
                            <div class="form-group full-width">
                                <label class="form-label" for="dietaryDetails">Dietary Requirements</label>
                                <textarea class="form-input" id="dietaryDetails" rows="2" placeholder="Specify any dietary requirements, allergies, or preferences..."></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label" for="endOfLifePreferences">End of Life Preferences</label>
                                <textarea class="form-input" id="endOfLifePreferences" rows="3" placeholder="Any wishes regarding end-of-life care, palliative care, pain management, or where you wish to spend your final days..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="organDonation">Organ Donation Preference</label>
                                <select class="form-input" id="organDonation">
                                    <option value="">Not specified</option>
                                    <option value="yes-all">Yes - donate all suitable organs</option>
                                    <option value="yes-some">Yes - donate specific organs only</option>
                                    <option value="no">No - I do not wish to donate organs</option>
                                    <option value="defer">Defer to my family's decision</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="namedMedicalProfessional">Named Medical Professional to Consult</label>
                                <input type="text" class="form-input" id="namedMedicalProfessional" placeholder="e.g., Dr. Jane Smith, GP at Elm Surgery">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Living Arrangements</h3>
                        <p class="form-description">Describe your preferences for where and how you would like to live if you lose capacity.</p>

                        <div class="form-group full-width">
                            <label class="form-label" for="livingArrangements">Living Arrangement Preferences</label>
                            <textarea class="form-input" id="livingArrangements" rows="3" placeholder="e.g., Prefer to remain in my current home, close to family, near specific amenities or services..."></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Burial / Funeral Wishes</h3>
                        <p class="form-description">While LPA authority ends at death, including these ensures your attorney knows your wishes and can advocate for them during the transition period.</p>

                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefBurialArrangements">
                                <span><strong>Specific Burial Arrangements:</strong> I prefer specific burial arrangements (e.g., particular cemetery, burial vs. cremation, type of service).</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefNoEmbalming">
                                <span><strong>No Embalming:</strong> I do not wish to be embalmed unless legally required.</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="prefFuneralType">
                                <span><strong>Preferred Funeral Type:</strong> I prefer a specific type of funeral service (e.g., religious ceremony, celebration of life, woodland burial, simple cremation).</span>
                            </label>
                        </div>

                        <div class="form-group full-width" style="margin-top: 1rem;">
                            <label class="form-label" for="emergencyEndOfLifeContact">Emergency Contact for End-of-Life</label>
                            <input type="text" class="form-input" id="emergencyEndOfLifeContact" placeholder="Name and contact details of person to contact at end of life">
                        </div>

                        <div class="form-grid" style="margin-top: 1rem;">
                            <div class="form-group full-width">
                                <label class="form-label" for="additionalCareInstructions">Additional Care Instructions</label>
                                <textarea class="form-input" id="additionalCareInstructions" rows="3" placeholder="Any specific binding instructions your attorneys MUST follow regarding your health and welfare..."></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label" for="additionalCarePreferences">Additional Care Preferences</label>
                                <textarea class="form-input" id="additionalCarePreferences" rows="3" placeholder="Any other non-binding guidance for your attorneys regarding your care and welfare..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== STEP 8: Certificate Provider ==================== -->
            <section class="step" data-step="8">
                <div class="step-header">
                    <span class="step-icon">‚úÖ</span>
                    <h2>Certificate Provider</h2>
                    <p>Section 8 of the official LPA form - someone who confirms you understand what you're doing</p>
                </div>

                <div class="info-box">
                    <h4>What is a Certificate Provider?</h4>
                    <p>A certificate provider is an independent person who certifies that you understand the LPA, that no one is forcing you to make it, and that there is nothing to prevent it from being created.</p>
                    <p style="margin-top: 0.5rem;">They must be either:</p>
                    <ul style="margin-top: 0.25rem; padding-left: 1.5rem;">
                        <li>Someone who has known you personally for at least 2 years, OR</li>
                        <li>A professional (solicitor, doctor, social worker, etc.)</li>
                    </ul>
                    <p style="margin-top: 0.5rem;"><strong>They cannot be:</strong> one of your attorneys, a family member of an attorney, or someone under 18.</p>
                </div>

                <div class="form-section">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required" for="certProviderTitle">Title</label>
                            <select class="form-input" id="certProviderTitle" required>
                                <option value="">Select...</option>
                                <option value="Mr">Mr</option>
                                <option value="Mrs">Mrs</option>
                                <option value="Miss">Miss</option>
                                <option value="Ms">Ms</option>
                                <option value="Dr">Dr</option>
                                <option value="Prof">Prof</option>
                                <option value="Rev">Rev</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="certProviderFirstNames">First Names</label>
                            <input type="text" class="form-input" id="certProviderFirstNames" required placeholder="First names">
                        </div>
                        <div class="form-group">
                            <label class="form-label required" for="certProviderLastName">Last Name</label>
                            <input type="text" class="form-input" id="certProviderLastName" required placeholder="Last name">
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label required" for="certProviderAddress">Address (including postcode)</label>
                            <textarea class="form-input" id="certProviderAddress" required rows="3" placeholder="Full address including postcode"></textarea>
                        </div>
                    </div>

                    <h4 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">How do they qualify?</h4>
                    <div class="radio-cards">
                        <label class="radio-card">
                            <input type="radio" name="certProviderType" value="knowledge" checked>
                            <div class="radio-card-content">
                                <h4>Personal Knowledge</h4>
                                <p>They have known you personally for at least 2 years.</p>
                            </div>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="certProviderType" value="professional">
                            <div class="radio-card-content">
                                <h4>Professional</h4>
                                <p>They are a professional (solicitor, doctor, social worker, etc.) with relevant skills.</p>
                            </div>
                        </label>
                    </div>

                    <div class="form-group full-width" style="margin-top: 1rem;">
                        <label class="form-label" for="certProviderRelationship">Relationship / Professional Details</label>
                        <textarea class="form-input" id="certProviderRelationship" rows="2" placeholder="e.g., Family friend for 10 years, Solicitor at Smith & Co, GP at local surgery..."></textarea>
                    </div>
                </div>
            </section>

            <!-- ==================== STEP 9: Review & Generate ==================== -->
            <section class="step" data-step="9">
                <div class="step-header">
                    <span class="step-icon">üìã</span>
                    <h2>Review Your LPA</h2>
                    <p>Please check all information before generating your LPA documents</p>
                </div>

                <div id="reviewContent">
                    <p>Loading review...</p>
                </div>

                <!-- Generate Section -->
                <div class="form-section" style="margin-top: 2rem;">
                    <div class="info-box info-warning">
                        <strong>Important Next Steps:</strong>
                        <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                            <li>Print both documents and review them carefully</li>
                            <li>Have a solicitor review the LPA before signing</li>
                            <li>The Donor signs first, then the Certificate Provider, then each Attorney</li>
                            <li>Register the LPA with the Office of the Public Guardian (fee applies)</li>
                        </ol>
                    </div>

                    <!-- Document Tabs -->
                    <div class="doc-tabs">
                        <button class="doc-tab active" data-tab="standard" onclick="showStandardDoc()">LPA Document</button>
                        <button class="doc-tab" data-tab="gov" onclick="showGovForm()">Government Form</button>
                    </div>

                    <!-- Standard LPA Document -->
                    <div id="standardLpaDoc" class="lpa-document">
                        <p>Generating LPA document...</p>
                    </div>

                    <!-- Government Form Download Section -->
                    <div id="govFormDoc" style="display: none;">
                        <div style="background: white; border: 1px solid var(--border); border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow-lg);">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <span style="font-size: 3rem; display: block; margin-bottom: 1rem;">üìã</span>
                                <h2 style="color: var(--primary); margin-bottom: 0.5rem;">Download Pre-filled Official Form</h2>
                                <p style="color: var(--text-light);">Your wizard data will be filled into the official UK Government LP1F or LP1H form.</p>
                            </div>

                            <div id="govFormSummary" style="margin-bottom: 2rem;"></div>

                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem;">
                                <button class="btn btn-primary" onclick="fillAndDownloadPdf()" id="downloadPdfBtn" style="font-size: 1.1rem; padding: 1rem 2rem;">
                                    üì• Download Pre-filled PDF
                                </button>
                            </div>

                            <div class="info-box info-warning" style="margin-bottom: 1.5rem;">
                                <strong>What gets pre-filled:</strong>
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li>Section 1: Donor details (name, DOB, address, email)</li>
                                    <li>Section 2: Attorney details (up to 4 attorneys)</li>
                                    <li>Section 3: How attorneys make decisions</li>
                                    <li>Section 4: Replacement attorney details</li>
                                    <li id="govFormSection5Info">Section 5: When attorneys can act</li>
                                    <li>Section 6: People to notify</li>
                                    <li>Section 7: Preferences and instructions</li>
                                    <li>Section 10: Certificate provider details</li>
                                </ul>
                            </div>

                            <div class="info-box info-tip">
                                <strong>You still need to complete manually:</strong>
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem; font-size: 0.9rem;">
                                    <li>Section 9: Donor signature + witness details</li>
                                    <li>Section 10: Certificate provider signature</li>
                                    <li>Section 11: Attorney/replacement attorney signatures + witnesses</li>
                                    <li>Sections 12-15: Registration details, fee payment, and final signatures</li>
                                </ul>
                            </div>

                            <p style="text-align: center; font-size: 0.85rem; color: var(--text-light); margin-top: 1rem;">
                                The official form must be printed, signed in the correct order, and submitted to the Office of the Public Guardian for registration.
                            </p>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons" style="margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="printCurrentDoc()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                            Print LPA
                        </button>
                        <button class="btn btn-secondary" onclick="fillAndDownloadPdf()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            Download Official Form (PDF)
                        </button>
                        <button class="btn btn-outline-accent" onclick="saveProgress()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                            Save to Database
                        </button>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Navigation Buttons -->
    <div class="navigation">
        <div class="container nav-buttons">
            <button class="btn btn-nav btn-nav-prev" id="prevBtn" onclick="changeStep(-1)" style="display: none;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Previous
            </button>
            <button class="btn btn-nav btn-nav-next" id="nextBtn" onclick="changeStep(1)">
                Next Step
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Standard LPA Generator - Compliant with the Mental Capacity Act 2005</p>
            <p style="margin-top: 0.25rem; font-size: 0.75rem;">This tool generates LPA documents for guidance purposes. Please have all documents reviewed by a qualified solicitor before signing and registering.</p>
        </div>
    </footer>

    <!-- ==================== MODALS ==================== -->

    <!-- Saved LPAs Modal -->
    <div class="modal" id="savedLpasModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Saved LPAs</h3>
                <button class="modal-close" onclick="closeSavedLpasModal()">&times;</button>
            </div>
            <div class="modal-body" id="savedLpasList">
                <p>Loading...</p>
            </div>
        </div>
    </div>

    <!-- Load Options Modal -->
    <div class="modal" id="loadOptionsModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Open LPA: <span id="loadLpaName"></span></h3>
                <button class="modal-close" onclick="closeLoadOptionsModal()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <p>What would you like to do with this LPA?</p>
                <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                    <button class="btn btn-primary" onclick="loadLpaAndView()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        View Document
                    </button>
                    <button class="btn btn-secondary" onclick="loadLpaAndEdit()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                        Edit LPA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal" style="display: none;">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3>Success</h3>
                <button class="modal-close" onclick="closeSuccessModal()">&times;</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
                <p id="successMessage">Your LPA has been saved successfully.</p>
                <button class="btn btn-primary" style="margin-top: 1.5rem;" onclick="closeSuccessModal()">OK</button>
            </div>
        </div>
    </div>

    <!-- Government Form Preview Modal -->
    <div class="modal" id="govFormPreviewModal" style="display: none;">
        <div class="modal-content" style="max-width: 650px;">
            <div class="modal-header">
                <h3>Official LPA Form Structure</h3>
                <button class="modal-close" onclick="closeGovFormPreview()">&times;</button>
            </div>
            <div class="modal-body gov-preview-content">
                <p style="margin-bottom: 1rem; color: #6b7280;">This is the structure of the official government LPA form. The wizard will collect your information and pre-fill these sections for you.</p>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">1</span></div>
                    <div>
                        <div class="gov-section-title">The donor</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">Your personal details (name, DOB, address)</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">2</span></div>
                    <div>
                        <div class="gov-section-title">The attorney(s)</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">Details of who you're appointing and how they should act</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">3</span></div>
                    <div>
                        <div class="gov-section-title" id="previewSection3Title">When attorneys can act</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;" id="previewSection3Desc">Whether attorneys can act immediately or only when you lack capacity</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">4</span></div>
                    <div>
                        <div class="gov-section-title">Replacement attorney(s)</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">Backup attorneys if your chosen ones can no longer act</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">5</span></div>
                    <div>
                        <div class="gov-section-title">People to notify</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">People who should know when the LPA is being registered</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem; border-color: var(--primary);">
                    <div><span class="gov-section-number" style="background: var(--primary);">6</span></div>
                    <div>
                        <div class="gov-section-title" style="font-weight: 700;">Preferences and instructions</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem; font-weight: 500;">Your preferences and binding instructions for your attorneys</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">7</span></div>
                    <div>
                        <div class="gov-section-title">The donor's signature</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">You sign here in the presence of a witness</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">8</span></div>
                    <div>
                        <div class="gov-section-title">Certificate provider's declaration</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">An independent person certifies you understand the LPA</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">9</span></div>
                    <div>
                        <div class="gov-section-title">Attorney(s)' signatures</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">Each attorney signs to accept their appointment</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0.75rem;">
                    <div><span class="gov-section-number">10</span></div>
                    <div>
                        <div class="gov-section-title">Replacement attorney(s)' signatures</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">Each replacement attorney signs</p>
                    </div>
                </div>

                <div class="gov-form-section" style="margin-bottom: 0;">
                    <div><span class="gov-section-number">11</span></div>
                    <div>
                        <div class="gov-section-title">Application to register</div>
                        <p style="font-size: 0.85rem; color: #6b7280; padding: 0.5rem;">Submit to the Office of the Public Guardian with the registration fee</p>
                    </div>
                </div>

                <div style="margin-top: 1.5rem; text-align: center;">
                    <button class="btn btn-primary btn-lg" onclick="closeGovFormPreview()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
                        Got it - Let's Start
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="lpa-standard-script.js"></script>
</body>
</html>
